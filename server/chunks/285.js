"use strict";exports.id=285,exports.ids=[285],exports.modules={285:(e,t,s)=>{s.r(t),s.d(t,{GoogleCastProvider:()=>c});var a=s(5247),i=s(1813),r=s(5825);s(3210);class n{#e;constructor(e){this.#e=new chrome.cast.media.MediaInfo(e.src,e.type)}build(){return this.#e}setStreamType(e){return e.includes("live")?this.#e.streamType=chrome.cast.media.StreamType.LIVE:this.#e.streamType=chrome.cast.media.StreamType.BUFFERED,this}setTracks(e){return this.#e.tracks=e.map(this.#t),this}setMetadata(e,t){return this.#e.metadata=new chrome.cast.media.GenericMediaMetadata,this.#e.metadata.title=e,this.#e.metadata.images=[{url:t}],this}#t(e,t){let s=new chrome.cast.media.Track(t,chrome.cast.media.TrackType.TEXT);return s.name=e.label,s.trackContentId=e.src,s.trackContentType="text/vtt",s.language=e.language,s.subtype=e.kind.toUpperCase(),s}}class o{#s;#a;#i;constructor(e,t,s){this.#s=e,this.#a=t,this.#i=s}setup(){let e=this.syncRemoteActiveIds.bind(this);(0,a.listenEvent)(this.#a.audioTracks,"change",e),(0,a.listenEvent)(this.#a.textTracks,"mode-change",e),(0,a.effect)(this.#r.bind(this))}getLocalTextTracks(){return this.#a.$state.textTracks().filter(e=>e.src&&"vtt"===e.type)}#n(){return this.#a.$state.audioTracks()}#o(e){let t=this.#s.mediaInfo?.tracks??[];return e?t.filter(t=>t.type===e):t}#c(){let e=[],t=this.#n().find(e=>e.selected),s=this.getLocalTextTracks().filter(e=>"showing"===e.mode);if(t){let s=this.#o(chrome.cast.media.TrackType.AUDIO),a=this.#h(s,t);a&&e.push(a.trackId)}if(s?.length){let t=this.#o(chrome.cast.media.TrackType.TEXT);if(t.length)for(let a of s){let s=this.#h(t,a);s&&e.push(s.trackId)}}return e}#r(){let e=this.getLocalTextTracks();if(!this.#s.isMediaLoaded)return;let t=this.#o(chrome.cast.media.TrackType.TEXT);for(let s of e)if(!this.#h(t,s)){(0,a.untrack)(()=>this.#i?.());break}}syncRemoteTracks(e){if(!this.#s.isMediaLoaded)return;let t=this.#n(),s=this.getLocalTextTracks(),a=this.#o(chrome.cast.media.TrackType.AUDIO),r=this.#o(chrome.cast.media.TrackType.TEXT);for(let s of a){if(this.#l(t,s))continue;let a={id:s.trackId.toString(),label:s.name,language:s.language,kind:s.subtype??"main",selected:!1};this.#a.audioTracks[i.jH.add](a,e)}for(let t of r){if(this.#l(s,t))continue;let a={id:t.trackId.toString(),src:t.trackContentId,label:t.name,language:t.language,kind:t.subtype.toLowerCase()};this.#a.textTracks.add(a,e)}}syncRemoteActiveIds(e){if(!this.#s.isMediaLoaded)return;let t=this.#c(),s=new chrome.cast.media.EditTracksInfoRequest(t);this.#d(s).catch(e=>{})}#d(e){let t=(0,r.getCastSessionMedia)();return new Promise((s,a)=>t?.editTracksInfo(e,s,a))}#l(e,t){return e.find(e=>this.#u(e,t))}#h(e,t){return e.find(e=>this.#u(t,e))}#u(e,t){return t.name===e.label&&t.language===e.language&&t.subtype.toLowerCase()===e.kind.toLowerCase()}}class c{#m;#a;#y;#p;#g;#T;#f;#k;#C;#E;#v;#S;constructor(e,t){this.$$PROVIDER_TYPE="GOOGLE_CAST",this.scope=(0,a.createScope)(),this.#p=null,this.#g="disconnected",this.#T=0,this.#f=0,this.#k=new i.zJ(0,0),this.#C=new i.e8(this.#x.bind(this)),this.#v=null,this.#S=!1,this.#m=e,this.#a=t,this.#y=new o(e,t,this.#i.bind(this))}get type(){return"google-cast"}get currentSrc(){return this.#p}get player(){return this.#m}get cast(){return(0,r.getCastContext)()}get session(){return(0,r.getCastSession)()}get media(){return(0,r.getCastSessionMedia)()}get hasActiveSession(){return(0,r.hasActiveCastSession)(this.#p)}setup(){this.#L(),this.#I(),this.#y.setup(),this.#a.notify("provider-setup",this)}#L(){(0,r.listenCastContextEvent)(cast.framework.CastContextEventType.CAST_STATE_CHANGED,this.#R.bind(this))}#I(){let e=cast.framework.RemotePlayerEventType,t={[e.IS_CONNECTED_CHANGED]:this.#R,[e.IS_MEDIA_LOADED_CHANGED]:this.#A,[e.CAN_CONTROL_VOLUME_CHANGED]:this.#b,[e.CAN_SEEK_CHANGED]:this.#M,[e.DURATION_CHANGED]:this.#w,[e.IS_MUTED_CHANGED]:this.#D,[e.VOLUME_LEVEL_CHANGED]:this.#D,[e.IS_PAUSED_CHANGED]:this.#N,[e.LIVE_SEEKABLE_RANGE_CHANGED]:this.#P,[e.PLAYER_STATE_CHANGED]:this.#_};this.#E=t;let s=this.#O.bind(this);for(let e of(0,a.keysOf)(t))this.#m.controller.addEventListener(e,s);(0,a.onDispose)(()=>{for(let e of(0,a.keysOf)(t))this.#m.controller.removeEventListener(e,s)})}async play(){if(this.#m.isPaused||this.#S){if(this.#S)return void await this.#G(!1,0);this.#m.controller?.playOrPause()}}async pause(){this.#m.isPaused||this.#m.controller?.playOrPause()}getMediaStatus(e){return new Promise((t,s)=>{this.media?.getStatus(e,t,s)})}setMuted(e){(e&&!this.#m.isMuted||!e&&this.#m.isMuted)&&this.#m.controller?.muteOrUnmute()}setCurrentTime(e){this.#m.currentTime=e,this.#a.notify("seeking",e),this.#m.controller?.seek()}setVolume(e){this.#m.volumeLevel=e,this.#m.controller?.setVolumeLevel()}async loadSource(e){if(this.#v?.src!==e&&(this.#v=null),(0,r.hasActiveCastSession)(e)){this.#V(),this.#p=e;return}this.#a.notify("load-start");let t=this.#H(e),s=await this.session.loadMedia(t);if(s){this.#p=null,this.#a.notify("error",Error((0,r.getCastErrorMessage)(s)));return}this.#p=e}destroy(){this.#$(),this.#F()}#$(){this.#v||(this.#f=0,this.#k=new i.zJ(0,0)),this.#C.stop(),this.#T=0,this.#v=null}#V(){let e=new a.DOMEvent("resume-session",{detail:this.session});this.#A(e);let{muted:t,volume:s,savedState:i}=this.#a.$state,r=i();this.setCurrentTime(Math.max(this.#m.currentTime,r?.currentTime??0)),this.setMuted(t()),this.setVolume(s()),r?.paused===!1&&this.play()}#F(){this.cast.endCurrentSession(!0);let{remotePlaybackLoader:e}=this.#a.$state;e.set(null)}#U(){let{savedState:e}=this.#a.$state;e.set({paused:this.#m.isPaused,currentTime:this.#m.currentTime}),this.#F()}#x(){this.#z()}#O(e){this.#E[e.type].call(this,e)}#R(e){let t=this.cast.getCastState(),s=t===cast.framework.CastState.CONNECTED?"connected":t===cast.framework.CastState.CONNECTING?"connecting":"disconnected";if(this.#g===s)return;let a=this.#J(e);this.#g=s,this.#a.notify("remote-playback-change",{type:"google-cast",state:s},a),"disconnected"===s&&this.#U()}#A(e){if(!this.#m.isMediaLoaded)return;let t=(0,a.peek)(this.#a.$state.source);Promise.resolve().then(()=>{if(t!==(0,a.peek)(this.#a.$state.source)||!this.#m.isMediaLoaded)return;this.#$();let s=this.#m.duration;this.#k=new i.zJ(0,s);let r={provider:this,duration:s,buffered:new i.zJ(0,0),seekable:this.#q()},n=this.#J(e);this.#a.notify("loaded-metadata",void 0,n),this.#a.notify("loaded-data",void 0,n),this.#a.notify("can-play",r,n),this.#b(),this.#M(e);let{volume:o,muted:c}=this.#a.$state;this.setVolume(o()),this.setMuted(c()),this.#C.start(),this.#y.syncRemoteTracks(n),this.#y.syncRemoteActiveIds(n)})}#b(){this.#a.$state.canSetVolume.set(this.#m.canControlVolume)}#M(e){let t=this.#J(e);this.#a.notify("stream-type-change",this.#X(),t)}#X(){return this.#m.mediaInfo?.streamType===chrome.cast.media.StreamType.LIVE?this.#m.canSeek?"live:dvr":"live":"on-demand"}#z(){if(this.#v)return;let e=this.#m.currentTime;e!==this.#T&&(this.#a.notify("time-change",e),e>this.#f&&(this.#f=e,this.#P()),this.#a.$state.seeking()&&this.#a.notify("seeked",e),this.#T=e)}#w(e){if(!this.#m.isMediaLoaded||this.#v)return;let t=this.#m.duration,s=this.#J(e);this.#k=new i.zJ(0,t),this.#a.notify("duration-change",t,s)}#D(e){if(!this.#m.isMediaLoaded)return;let t={muted:this.#m.isMuted,volume:this.#m.volumeLevel},s=this.#J(e);this.#a.notify("volume-change",t,s)}#N(e){let t=this.#J(e);this.#m.isPaused?this.#a.notify("pause",void 0,t):this.#a.notify("play",void 0,t)}#P(e){let t={seekable:this.#q(),buffered:new i.zJ(0,this.#f)},s=e?this.#J(e):void 0;this.#a.notify("progress",t,s)}#_(e){let t=this.#m.playerState,s=chrome.cast.media.PlayerState;if(this.#S=t===s.IDLE,t===s.PAUSED)return;let a=this.#J(e);switch(t){case s.PLAYING:this.#a.notify("playing",void 0,a);break;case s.BUFFERING:this.#a.notify("waiting",void 0,a);break;case s.IDLE:this.#C.stop(),this.#a.notify("pause"),this.#a.notify("end")}}#q(){return this.#m.liveSeekableRange?new i.zJ(this.#m.liveSeekableRange.start,this.#m.liveSeekableRange.end):this.#k}#J(e){return e instanceof Event?e:new a.DOMEvent(e.type,{detail:e})}#B(e){let{streamType:t,title:s,poster:a}=this.#a.$state;return new n(e).setMetadata(s(),a()).setStreamType(t()).setTracks(this.#y.getLocalTextTracks()).build()}#H(e){let t=this.#B(e),s=new chrome.cast.media.LoadRequest(t),a=this.#a.$state.savedState();return s.autoplay=(this.#v?.paused??a?.paused)===!1,s.currentTime=this.#v?.time??a?.currentTime??0,s}async #G(e,t){let s=(0,a.peek)(this.#a.$state.source);this.#v={src:s,paused:e,time:t},await this.loadSource(s)}#i(){this.#G(this.#m.isPaused,this.#m.currentTime).catch(e=>{})}}}};